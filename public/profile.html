<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Profile - RealityLottery</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    body{background:#000;color:#fff;font-family:Arial, sans-serif;padding:20px;}
    .box{background:#111;padding:20px;border-radius:10px;border:2px solid #ffd700;max-width:600px;margin:auto;}
    h2{color:#ffd700;}
    ul{list-style:none;padding:0;}
    li{padding:8px 0;border-bottom:1px solid #333;}
    .step{margin:5px 0;padding:8px;border-radius:6px;}
    .done{background:#2e7d32;}
    .pending{background:#7b1fa2;}
  </style>
</head>
<body>
  <div class="box">
    <h2>My Profile</h2>
    <div id="profileInfo">Loading...</div>
    <h3>My Tasks</h3>
    <div id="tasks"></div>
  </div>

  <script>
    const API_BASE="https://realitylottery.koyeb.app";
    const token=localStorage.getItem("rl_token");
    if(!token){location.href="login.html";}

    async function loadProfile(){
      const res=await fetch(API_BASE+"/api/auth/me",{headers:{Authorization:"Bearer "+token}});
      if(!res.ok){localStorage.removeItem("rl_token");location.href="login.html";return;}
      const data=await res.json();
      const u=data.user;
      document.getElementById("profileInfo").innerHTML=`
        <ul>
          <li><b>Username:</b> ${u.username}</li>
          <li><b>Email:</b> ${u.email}</li>
          <li><b>Subscription:</b> ${u.subscriptionType||"None"}</li>
          <li><b>Balance:</b> ${u.balance||0} USDT</li>
        </ul>
      `;
      renderTasks(u);
    }

    function renderTasks(user){
      const steps=6;
      let done= user.completedSteps || 0;
      let html="";
      for(let i=1;i<=steps;i++){
        html+=`<div class="step ${i<=done?'done':'pending'}">Step ${i} - ${i<=done?'Completed':'Pending'}</div>`;
      }
      document.getElementById("tasks").innerHTML=html;
    }

    loadProfile();
  </script>
</body>
</html>
