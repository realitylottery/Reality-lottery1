<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Withdrawal - RealityLottery</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * {margin:0;padding:0;box-sizing:border-box;font-family:Arial,sans-serif;}
    body {background:#000;color:#fff;min-height:100vh;display:flex;flex-direction:column;}
    header {padding:20px;background:#111;border-bottom:2px solid #ffd700;}
    .logo {font-size:28px;font-weight:bold;color:#ffd700;}
    .content {flex:1;padding:20px;max-width:500px;margin:auto;text-align:left;}
    label {display:block;margin:12px 0 6px;color:#ffd700;font-weight:bold;}
    input {width:100%;padding:10px;border-radius:6px;border:none;margin-bottom:10px;}
    button {padding:12px;width:100%;background:#ffd700;color:#000;font-weight:bold;border:none;border-radius:6px;cursor:pointer;}
    button:hover {background:#ffa500;}
    .status {margin-top:15px;padding:10px;border-radius:6px;background:#111;}
    footer {position:fixed;bottom:0;left:0;right:0;background:#111;border-top:2px solid #ffd700;
      padding:10px 0;display:flex;justify-content:space-around;align-items:center;}
    footer a {color:#ffd700;text-decoration:none;font-size:14px;font-weight:bold;display:flex;flex-direction:column;align-items:center;}
    footer a i {font-size:18px;margin-bottom:4px;}
    footer a:hover {color:#ffa500;}
  </style>
</head>
<body>
<header>
  <div class="logo">Withdrawal</div>
</header>

<section class="content">
  <h2>Your Balance: <span id="balance">Loading...</span> USDT</h2>

  <label>Amount to Withdraw</label>
  <input type="number" id="amount" placeholder="Enter amount">

  <label>Wallet Address</label>
  <input type="text" id="wallet" placeholder="Enter USDT Wallet Address">

  <button onclick="submitWithdrawal()">Withdraw</button>

  <div class="status" id="statusBox" style="display:none;"></div>
</section>

<footer>
  <a href="index.html"><i class="fas fa-home"></i>Home</a>
  <a href="news.html"><i class="fas fa-newspaper"></i>News</a>
  <a href="withdrawal.html"><i class="fas fa-wallet"></i>Withdrawal</a>
  <a href="profile.html"><i class="fas fa-user"></i>Profile</a>
</footer>

<script>
const API_BASE = "https://realitylottery.koyeb.app";
const token = localStorage.getItem("rl_token");

async function loadBalance(){
  if(!token){ document.getElementById("balance").textContent="Login required"; return; }
  const res = await fetch(API_BASE+"/api/auth/me",{headers:{"Authorization":"Bearer "+token}});
  const data = await res.json();
  document.getElementById("balance").textContent = data.user?.balance || 0;
}
loadBalance();

async function submitWithdrawal(){
  const amount = document.getElementById("amount").value;
  const wallet = document.getElementById("wallet").value;
  if(!amount || !wallet){alert("Fill all fields");return;}

  const res = await fetch(API_BASE+"/api/withdrawals",{
    method:"POST",
    headers:{"Content-Type":"application/json","Authorization":"Bearer "+token},
    body:JSON.stringify({amount,wallet})
  });
  const data = await res.json();
  const box = document.getElementById("statusBox");
  box.style.display="block";
  if(res.ok){
    box.textContent = "✅ Withdrawal request submitted. Status: Processing...";
  } else {
    box.textContent = "❌ Error: "+data.message;
  }
}
</script>
</body>
</html>
